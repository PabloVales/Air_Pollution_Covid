# AIR POLLUTION AND HOW COVID WAS GOOD FOR OUR LUNGS

In this repository I undertake an air quality analysis of Spain in the 2019-2020 period, across 23 cities in the country.  The studied pollutants are NO<sub>2</sub>, PM<sub>25</sub>, PM<sub>10</sub>
and SO<sub>2</sub>, which are the main ones generated by industry and vehicles, with a stronger emphasis on NO<sub>2</sub> as it is one of the main markers related to vehicle traffic. 


## MOTIVATION

Anthropogenic contamination is on the rise and has been a main issue since the industrial revolution. Most of these contaminants and their consequences do not affect humans directly and in the short term. However, since we live in large and dense population masses, airborne generated pollutants get concentrated and do affect our health. 

The Covid-19 outbreak and the health security measures taken during 2020 have been an ideal field of study on many cities across the world to check how much air pollution decreased in the cities, under what circumstances and more importantly, how fast. This provides us with very useful data to understand how contamination decreases given a particular set of restrictions. 

Therefore, for this study we will focus in Spain, which was one of the most strict in terms of health security measures: 3 months mandatory confinement from March 15th to June 21st and mobility restrictions for the remaining of 2020. 

## OBJECTIVE

The overall aim of this work is to analyze how much the air quality got affected by the Covid-19 restrictions during 2020. Specifically:

1. Evaluate how much the air quality varied during the year 2020 relative to 2019 in the whole country and which pollutant underwent the largest variation.
2. How was the monthly evolution across the whole year of 2020
3. What cities showed the largest pollution decrease in 2020.


## DATASET

Data was extracted from the www.aqi.cn webpage from a dataset that originally has daily data for 94 different countries across more than 600 cities of the US AQI index (https://www.airnow.gov/aqi/aqi-basics/). For this study the data was limited to only one country (Spain) as it was one of the most strict in terms of health security measures. 

The dataset contains 9 different columns representing the date, country (country code), city, specie of pollutant, number of measurements in a particular day (count), min and max values, the median AQI value of the distribution and the variance of the distribution for each day. 

Moreover, since the countries are provided with the country codes, which can be quite cryptic sometimes a dataset with the actual country names was merged with the air quality dataset, obtained from datahub.io at https://datahub.io/core/country-list

## METHODOLOGY

Column features were limited to date, country, city, specie of pollutant and median values since the variance provided for each day was not related to the variance of the distribution of medians but rather to the distribution of the raw data and no assumptions on normality wanted to be made for the daily distribution. Therefore, the natural spread of the daily data was used instead. 

To ensure that every city has the same weight in the averaging process a bottom-up approach is applied. This means that if, for example, we want to obtain the monthly air quality average of the country, first the monthly average in every city is done separately and then the average of the country is done based on the previously calculated values. This is opposite to taking all the daily values of all cities in the country for a particular month and do the average on that. If this is done, then the cities that have more measurements in that particular month will have a larger weight in the averaging and we would have inconsistent measurements across months. 

The variance and standard deviations of the calculated values are done assuming independent and identically distributed (i.i.d) variables i.e Cov(X,Y) = 0, where {X} and {Y} correspond to the variables linked to the years 2019 and 2020, respectively. For each calculation step a t-student 95% confidence interval (CI) is used to account for small sample sizes via:

<img src="https://latex.codecogs.com/svg.latex?\bar{X}&space;\pm&space;t_{n-1,&space;1-\alpha/2}&space;\frac{S}{\sqrt{n}}" title="\bar{X} \pm t_{n-1, 1-\alpha/2} \frac{S}{\sqrt{n}}" />

where <img src="https://latex.codecogs.com/svg.latex?\inline&space;t_{n-1,&space;1-\alpha/2}" title="t_{n-1, 1-\alpha/2}" /> is the <img src="https://latex.codecogs.com/svg.latex?\inline&space;\alpha^{th}" title="\alpha^{th}" /> quantile of the t distribution with df degrees of freedom and S is the standard deviation of the sample.

This CI will be the one used in the error bars in all figures in the present work.

When doing comparisons of averages between months or years an unpaired t-test is applied where no assumptions about variances are made between both distributions and thus, a Welchâ€™s t-test is used where the statistic is:


<a href="https://www.codecogs.com/eqnedit.php?latex=\centering&space;\frac{{}\bar{Y}-&space;\bar{X}-(\mu_y-\mu_x)}{\left(\frac{S^2_x}{n_x}&space;&plus;&space;\frac{S^2_y}{n_y}&space;\right&space;)^{1/2}}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\centering&space;\frac{{}\bar{Y}-&space;\bar{X}-(\mu_y-\mu_x)}{\left(\frac{S^2_x}{n_x}&space;&plus;&space;\frac{S^2_y}{n_y}&space;\right&space;)^{1/2}}" title="\centering \frac{{}\bar{Y}- \bar{X}-(\mu_y-\mu_x)}{\left(\frac{S^2_x}{n_x} + \frac{S^2_y}{n_y} \right )^{1/2}}" /></a>

with degrees of freedom:

<a href="https://www.codecogs.com/eqnedit.php?latex=df&space;=&space;\frac{\left(&space;\frac{S^2_x}{n_x}&space;&plus;&space;\frac{S^2_y}{n_y}\right&space;)^2}{\frac{\left(&space;\frac{S^2_x}{n_x}\right)^2}{n_x&space;-1}&space;&plus;&space;\frac{\left(&space;\frac{S^2_y}{n_y}\right)^2}{n_y&space;-1}}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?df&space;=&space;\frac{\left(&space;\frac{S^2_x}{n_x}&space;&plus;&space;\frac{S^2_y}{n_y}\right&space;)^2}{\frac{\left(&space;\frac{S^2_x}{n_x}\right)^2}{n_x&space;-1}&space;&plus;&space;\frac{\left(&space;\frac{S^2_y}{n_y}\right)^2}{n_y&space;-1}}" title="df = \frac{\left( \frac{S^2_x}{n_x} + \frac{S^2_y}{n_y}\right )^2}{\frac{\left( \frac{S^2_x}{n_x}\right)^2}{n_x -1} + \frac{\left( \frac{S^2_y}{n_y}\right)^2}{n_y -1}}" /></a>


In order to obrtain the variance of the ratio (r) of the AQI values in 2020 relative to 2019 i.e r = Y-X/X = A/X, we calculate a first order approximation of a Taylor series of the statistic and then apply the variance on that, obtaining:

<a href="https://www.codecogs.com/eqnedit.php?latex=\sigma^2_{r}&space;=&space;r^2&space;\left&space;[&space;\left&space;(\frac{\sigma_A}{A}&space;\right&space;)^2&space;&plus;&space;\left&space;(\frac{\sigma_X}{X}&space;\right&space;)^2&space;\right&space;]" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\sigma^2_{r}&space;=&space;r^2&space;\left&space;[&space;\left&space;(\frac{\sigma_A}{A}&space;\right&space;)^2&space;&plus;&space;\left&space;(\frac{\sigma_X}{X}&space;\right&space;)^2&space;\right&space;]" title="\sigma^2_{r} = r^2 \left [ \left (\frac{\sigma_A}{A} \right )^2 + \left (\frac{\sigma_X}{X} \right )^2 \right ]" /></a>

where A = Y - X and <a href="https://www.codecogs.com/eqnedit.php?latex=\inline&space;\sigma_i" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\inline&space;\sigma_i" title="\sigma_i" /></a> are the standard deviation of the variables A and X.

## Files in repository

- 2019Q<sub>i</sub> and 2020Q<sub>i</sub>: csv files with the daily Air Quality Index (AQI) for 2019 and 2020 extracted from www.aqi.cn
- Country_codes: txt file with country codes and country names extrated from www.datahub.io
- AQI_notebook: Jupyter notebook with all the code and results from the analysis
  
## Summary

When analyzing the country as a whole, we have found that the pollutant that decreased the most during 2020 was NO2, with a yearly decrease of -XX%, followed by PM25 with a XX%.  However, these drop values exacerbate when looking at the monthly data due to the strict confinement that took place between March 15th and June 21st, accounting to a maximum decrease of XX% for NO2 and XX% for PM25 in April 2020, directly related to the (almost) complete absence of vehicle in the cities. 

The yearly NO2 values for individual cities show that there have been relative changes in 2020 compared to 2019 as deep as -50% in Palma, XX% in Madrid or XX% in Barcelona.

  
  
## Requirements

- Python 3.8.10
- Requests 2.25.1
- Re (RegEx) 2.2.1
- Numpy 1.20.2
- Pandas 1.2.4
- Matplotlib 3.3.4
- Seaborn 0.11.1
- Scipy 1.6.2
